--let $MYSQL_DATA_DIR=`select @@datadir`

# Test dynamic bool variable super_read_only
# Test readonly enum variable binlog_row_image

--echo #
--echo # Changing values
--echo #
SET PERSIST_ONLY super_read_only = OFF;
SET PERSIST_ONLY binlog_row_image = FULL;

SHOW VARIABLES WHERE Variable_name LIKE 'super_read_only' OR Variable_name LIKE 'binlog_row_image';
SELECT @@global.super_read_only;
SELECT @@global.binlog_row_image;
--source include/restart_mysqld.inc
SHOW VARIABLES WHERE Variable_name LIKE 'super_read_only' OR Variable_name LIKE 'binlog_row_image';
SELECT @@global.super_read_only;
SELECT @@global.binlog_row_image;

################################################################################################
--echo #
--echo # Changing values
--echo #
SET PERSIST_ONLY super_read_only = ON;
SET PERSIST_ONLY binlog_row_image = NOBLOB;

SHOW VARIABLES WHERE Variable_name LIKE 'super_read_only' OR Variable_name LIKE 'binlog_row_image';
SELECT @@global.super_read_only;
SELECT @@global.binlog_row_image;
--source include/restart_mysqld.inc
SHOW VARIABLES WHERE Variable_name LIKE 'super_read_only' OR Variable_name LIKE 'binlog_row_image';
SELECT @@global.super_read_only;
SELECT @@global.binlog_row_image;

################################################################################################
--echo #
--echo # Changing values
--echo #
SET PERSIST_ONLY super_read_only = off;
SET PERSIST_ONLY binlog_row_image = minimal;

SHOW VARIABLES WHERE Variable_name LIKE 'super_read_only' OR Variable_name LIKE 'binlog_row_image';
SELECT @@global.super_read_only;
SELECT @@global.binlog_row_image;
--source include/restart_mysqld.inc
SHOW VARIABLES WHERE Variable_name LIKE 'super_read_only' OR Variable_name LIKE 'binlog_row_image';
SELECT @@global.super_read_only;
SELECT @@global.binlog_row_image;

################################################################################################
--echo #
--echo # Changing values
--echo #
SET PERSIST_ONLY super_read_only = on;
SET PERSIST_ONLY binlog_row_image = full;

SHOW VARIABLES WHERE Variable_name LIKE 'super_read_only' OR Variable_name LIKE 'binlog_row_image';
SELECT @@global.super_read_only;
SELECT @@global.binlog_row_image;
--source include/restart_mysqld.inc
SHOW VARIABLES WHERE Variable_name LIKE 'super_read_only' OR Variable_name LIKE 'binlog_row_image';
SELECT @@global.super_read_only;
SELECT @@global.binlog_row_image;

################################################################################################
--echo #
--echo # Changing values
--echo #
SET PERSIST_ONLY super_read_only = 0;
SET PERSIST_ONLY binlog_row_image = 0;

SHOW VARIABLES WHERE Variable_name LIKE 'super_read_only' OR Variable_name LIKE 'binlog_row_image';
SELECT @@global.super_read_only;
SELECT @@global.binlog_row_image;
--source include/restart_mysqld.inc
SHOW VARIABLES WHERE Variable_name LIKE 'super_read_only' OR Variable_name LIKE 'binlog_row_image';
SELECT @@global.super_read_only;
SELECT @@global.binlog_row_image;

################################################################################################
--echo #
--echo # Changing values
--echo #
SET PERSIST_ONLY super_read_only = 1;
SET PERSIST_ONLY binlog_row_image = 2;

SHOW VARIABLES WHERE Variable_name LIKE 'super_read_only' OR Variable_name LIKE 'binlog_row_image';
SELECT @@global.super_read_only;
SELECT @@global.binlog_row_image;
--source include/restart_mysqld.inc
SHOW VARIABLES WHERE Variable_name LIKE 'super_read_only' OR Variable_name LIKE 'binlog_row_image';
SELECT @@global.super_read_only;
SELECT @@global.binlog_row_image;

################################################################################################
# Cleanup
--echo #
--echo # Cleanup
--echo #
--remove_file $MYSQL_DATA_DIR/mysqld-auto.cnf
--echo # Restart server with defaults
--source include/restart_mysqld.inc

